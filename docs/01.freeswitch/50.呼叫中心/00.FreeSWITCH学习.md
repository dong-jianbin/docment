---
title: FreeSWITCH学习
date: 2022-02-28 22:23:43
permalink: /pages/8b0cf6/
categories:
  - freeswitch
  - 呼叫中心
tags:
  - 
---

## PSTN与VoIP基础

- VoIP（Voice Over IP）：承载于IP网上的语音通信（网络电话）。
- PSTN（Public Switched Telephone Network）：公共交换电话网。

### PSTN起源与发展

>在漫长的通信历史长河中，PSTN以及电话交换技术的发展经历了很多阶段，如从直接控
>制到间接控制再到公共控制、从人工交换到自动交换、从点子交换到程控交换、从模拟到
>数字、从电路交换到分组交换、从“硬”交换到软交换。

#### 最早的电话网

第一次语音传输是苏格兰人亚历山大·贝尔（Alexander Granham Bell）在1876年用振铃电
路实现的。

振铃电路实现是没有电话号码的，通话用户之间必须由物理线路连接，同一时间只能一个
用户讲话。

#### 人工电话交换时代

交换机（[Switch](https://so.csdn.net/so/search?q=Switch&spm=1001.2101.3001.7020)，又称Exchange）的设备诞生了，线路大大减小。交换连续工作全部由人工
完成。

#### 自动电话交换时代

1889年到1891年期间，美国阿尔蒙·B·史端桥（Almon B Strowger）发明了步进式自动电话交
换机。属于“直接控制”方式。

以后，又出现了旋转式和升降式的交换机。采用“记发器”的部件来接收用户的拨号脉冲，属于
“间接控制”方式。

1919年，瑞典的电话工程师帕尔姆格伦和贝塔兰德发明了“纵横制连接器”。把控制器和话路器
分开。控制部分由标志器和记发器来完成。

#### 半电子交换机时代

控制部分引入了电子技术，而话路部分在较长的一段时间内仍采用机械触电。

#### 空分交换机时代

1965年5月，美国布尔系统的1号电子交换机（ESS No.1）问世了，这是世界上第一部开通使用
的程控电话交换机。当时的交换机话路部分还保留了机械触电，以“空分”方式工作，因此称为
空分交换机。交换的还是模拟信号。

#### 数字交换时代

20世纪60年代初以来，脉冲编码调制（PCM）技术成功地应用于传输系统中，它将“模拟”的信号
数字化，提高了通话质量、增加了传输距离，节约了许多线路成本。1970年，法国开通了世界上
第一部程控数字交换机E10，开始了数字交换的心时代。

#### 现代PSTN时代

随着技术的进步和通信要求的增加，世界上许许多多的交换机也需要相互通信，这些交换机之间
通过中继线（Trunk）相连，随着电子交换机和程控交换机的发展，便出现了现代意义的PSTN网
络。

20世纪70年代后期出现了蜂窝式移动电话（当移动电话小到可以拿到手里的时候就开始叫“手机”了
）系统，这是无线电话发展的里程碑。无限电话的出现，扩展了PSTN网络能力和范围，对PSTN网络
的影响及其深远。

专门用于移动电话交换的通信网络称为移动网，而原来的程控交换网则称为固定电话网，简称固网。
简单来说，移动网就是在普通固网上增加了许多基站（Base Station，可以简单理解为天线），并
增加了归属位置寄存器（Home Location Register，HLR）和拜访位置寄存器（Visitor Location
Register，VLR），以记录用户的位置（）、支持异地漫游等。移动交换中心称为MSC（Mobile Switch
Center）。

#### 下一代网络及VoIP时代

随着分组交换的成熟及英特网的发展，人们认识到了将原始的基于电路交换的语音网络与基于分组
交换的英特网络进行融合（即语音通信和数据通信相结合）的必要性，因此一个称为NGN（Next
Generation Network）的概念被提了出来。

经过数年的研究和探索，人们提出了各种NGN解决方案，但最终基本上都统一到了IMS（IP Multimedia
Subsystem）技术。

IMS属于核心交换层的技术，它全部基于IP网络，但在接入层，目前的语音大部分还是基于电路接入
的方式接入的，因此，在一定时间内IMS在接入层要继续兼容电路接入。未来的通信中要求完全取消
低效的电路传输及电路交换，而全部集中在IP通信上来，也就催生了新的无限通信标准LTE。

关于通信网络的演进，简单来说，在无线方面体现为从GSM/CDMA/UMTS等向LTE发展，在核心网方面则
体现为电路交换向IMS发展。

### 电话实现技术

#### 电话号码

1. 固定电话号码

   现行的电话网中采用E.164号码格式。

2. 移动电话号码和专用号段

   移动电话号码俗称手机号，由于其可移动与漫游的特性，与普通固定电话略有不同。我国的移动电话
   都是以1开头，按不同的运营商来划分。

3. 短号码

   有一类特殊的号码称为短号码，如110,119,120等。

4. 800和400号码

   800号码用手机打不通，400是可以手机呼叫的。

5. 北美电话号码分类计划

   加拿大和美国使用北美电话号码分类计划，其区号由3位数字组成，本地号码为7位数字，1为长途接入
   码，即长途字冠。

6. 电话号码书写格式

   国内号码的书写一般采用如下的方式：

   - (010)ABCD EFGH （没有国家代码，虽然0不是区号的一部分，但是，习惯了）
   - +86（10）ABCD EFGH （固话，8位，国际号码格式）
   - +86（10）ABCD EFGH （固话，8位，国际号码格式）
   - +86 139 ABCD EFGH （手机，国际号码格式）

#### 模拟信号与数字信号

模拟（Analog）量是连续的变化的量。容易引入噪音。

数字（Digital）信号是不连续的（离散的）。

####  PCM

PCM（Pulse Code Modulation）的全称是脉冲编码调制。它是一种通用的将模拟信号转换成以0和1表示
的数字信号的方法。

人的音频范围在300~3400Hz之间，通过滤波器将超过4000Hz的频率过滤出去，便得到4000Hz内的模拟信
号。然后根据抽样定理，使用8000Hz进行抽样，便得到离散的数字信号。使用PCM方法得到的数字信号
就称为PCM信号，一般一次抽样会得到16bit的信息。

使用压缩算法，可以将每一个抽样值压缩到8bit。这样1秒的抽样就得到8bit×8000=640000bit信号（简称
64kbit），抽样速率（即传输速率）为64Kbit/s。

PCM通常有两种压缩方式：A律和μ率。北美使用μ律，我国和欧洲使用A率。

#### 局间中继与电路复用技术

连接交换机（局）的E1或T1电路称为局间中继。

### 我国电话网结构

我国电话网由本地网与长途网组成，并通过国际交换中心进入国际电话网。

### 信令

用户设备（如话机）与端局交换机之间，以及交换机与交换机之间需要进行通信。这些通信所包含的信息有
（但不限于）用户、中继线状态、主叫号码、被叫号码、中继路由的选择等。我们把这些消息称为
信令（Signaling）。

#### 信令分类

按信令的功能分

- 线路信令：具有监视功能，用来监视主被叫的摘、挂机状态及设备忙闲。
- 路由信令：具有选择功能，指主叫所拨的被叫号码，用来选择路由
- 管理信令：具有操作功能，用于电话网的管理和维护。

按信令的工作区域分

- 用户线信令：是用户终端与交换机之间的信令。
- 局间信令：是交换机和交换机之间的信号，在局间中继线上传送，用来控制呼叫连续和拆线。

按信令的信道分

- 随路信令：信令和话音在同一条话路中传输。
- 公共信道信令：以时分方式在一条高速数据链路上传送一群话路。

其他分类

信令还可以分为带内信令和带外信令、模拟信令和数字信令、向前信令和向后信令、线路信令和记发器信令等。

#### 用户线信令

从用户终端（通常是话机）到端局交换机之间经常需要传送一些控制信息，如用户摘机、挂机、拨号、主叫号码
显示等，这些信息称为用户线信令。用户线信令可以通过模拟或数字信号传递。

#### 局间信令

交换机与交换机之间也需要传送控制信号，用于话路的建立、释放等，这些信号就称为局间信令。

目前在传统的PSTN网络中常见的局间信号有ISDN PRI（Primary Rate Interface，基群速率接口）信令和七号信令。
PRI信令和话路在同一个E1上传送。七号信令可以与话路在同一个E1上传送外，还可以在专门的用于传送信令链路的E1中继上传送。

#### 七号信令

七号信令（Signaling System No.7，SS7）是我国目前使用的主要信令方式，用于局间通信。我国的电话网络中有专
门的七号信令网。

由于ISUP（ISDN User Part，ISDN用户部分）能与ISDN互联并提供比TUP更多的能力和服务，故其已基本取代TUP成为我国七号信令网采用的主要信令方式。

#### H.323与SIP信令

H.323与SIP属于VoIP领域的通信信令，它们适用于用户线信令和局间信令。

H.323是ITU多媒体通信系列标准H.32x的一部分，该系列标准使得在现有通信网络上进行视频会议称为可能。

SIP（Session Initiation Protocol，会话发起协议）是由IETF（Interne 工程任务组）提出的IP电话信令协议。

### 媒体

信令主要传输一些控制信号，而通信双方需要听到的是对方的语音数据，这些语音数据就称为媒体（Media）.

在SIP通信中，除文字外，媒体都是在RTP协议中传输的。由于媒体一般都是持续传输的，因此又称RTP流。

### 电路交换与分组交换

传统电路交换，两个通信节点间需要建立一个专用通路。而报文交换以报文作为数据交换单位，携带目标地址、源地址等信息。分组交换是报文交换的特殊情形。

#### 电路交换

传统的电话都是基于电路交换的。

电路交换的优点：

- 由于通信线路为通信双方用户专用，数据直达，所以传输数据的时延性非常小。
- 通信双方之间的物理通路一旦建立，双方可以随时通信，实时性强。
- 双方通信时按发送顺序传输数据，不存在失序问题
- 电路交换既适用于传输模拟信号，又适用于传输数字信号。
- 进电路交换的设备（交换机等）及控制均较简单

电路交换的缺点：

- 电路交换的平均连接建立时间对计算机通信来说较长。
- 建立电路交换连接后，物理通路被通信双方独占，即使通信线路空闲，也不能供其他用户使用，因而通信利用率低。
- 在进行电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互进行通信，也难在通信过程中进行差错控制。

#### 分组交换

IP交换采用的就是分组交换方式。

分组交换的优点：

- 加快了数据在网络中的传输速度。
- 简化了存储管理。
- 减少了重发几率和重发数据量。
- 由于分组短小，更适用于采用优先级策略。

分组交换的缺点：

- 尽管分组交换比报文交换的传输时延少，但仍存在存储转发时延，而且节点交换机必须有更强的处理能力。
- 分组交换都要加上源、目的地址和分组编号，一定程度降低了通信效率，增加了处理时间，使控制复杂、
  时延增加。
- 分组到达目的节点时，要对分组按编号进行排序等工作，增加了麻烦。

### VoIP

IP电话（Voice over Internet Protocol，VoIP，又称宽带电话或网络电话）是一种透过互联网或其他使用
IP技术的网络来实现的新型电话通信。

目前，VoIP呼叫控制协议主要有SIP、H.323、MGCP与H.248/MEGACO等。

### IMS

#### 什么是IMS

IMS的全称是IP多媒体子系统（IP Multimedia Subsystem），它是一个基于IP网提供语音及多媒体的网络体系
架构。

#### IMS的特点

- 采用SIP作为呼叫控制协议。
- 支持Diameter协议。
- 采用归属控制方式。
- 采用接入无关性。
- 业务、控制、承载层完全分离。
- 增强计费功能。
- 增强多媒体业务。

#### IMS核心网元

1. **CSCF**

   CSCF（Call Sessoin Control Function，呼叫会话控制功能）。

   - 代理CSCF（P-CSCF）
   - 问询CSCF（I-CSCF）
   - 服务CSCF（S-CSCF）

2. **MGCF**

   MGCF（Media Gateway Control Function，媒体网关控制功能）

   - 控制IMS-MGW中的媒体信道的连接。
   - 与CSCF通信。
   - 根据路由号码，为从传统网络来的入局呼叫选择CSCF。
   - 执行ISUP协议和IMS呼叫控制协议间的转换。

3. **IM-MGW**

   IM-MGW（IP Multimedia-Media Gateway Function，多媒体网关功能）

   - 通过与MGCF交互来进行资源控制。
   - 拥有并维护回声消除器等资源。
   - 可能需要多媒体数字信号编、解码器。

4. **MRF**

   MRF（Multimedia Resource Function，多媒体资源功能）分成两部分，包括MRFC（Multimedia Resource Function Controller，多媒体资源功能控制器）和MRFP（Multimedia Resource Function Processor，多媒体资源功能处理器）。

5. **SLF**

   SLF（Subscription Locator Function，签约定位功能）

6. **HSS**

   HSS（Home Subscriber Server，归属用户服务功能）

7. **BGCF**

   BGCF（Breakout Gateway Control Function，出口网关控制功能）

8. **SGW**

   SGW（Singnalling Gateway Function，信令网关功能）

9. **AS**

   AS（Application Server，应用服务器）

